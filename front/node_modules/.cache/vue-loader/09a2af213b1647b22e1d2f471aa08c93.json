{"remainingRequest":"/Applications/MAMP/htdocs/iim/nodejs/todo_app/front/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Applications/MAMP/htdocs/iim/nodejs/todo_app/front/src/molecules/SignupForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Applications/MAMP/htdocs/iim/nodejs/todo_app/front/src/molecules/SignupForm.vue","mtime":1618942067000},{"path":"/Applications/MAMP/htdocs/iim/nodejs/todo_app/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Applications/MAMP/htdocs/iim/nodejs/todo_app/front/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Applications/MAMP/htdocs/iim/nodejs/todo_app/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Applications/MAMP/htdocs/iim/nodejs/todo_app/front/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB1c2VycyBmcm9tICcuLi9hcGkvdXNlcnMnCgppbXBvcnQgc3RvcmUgZnJvbSAnQC9zdG9yZS9pbmRleCcKaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nCmltcG9ydCBDb29raWVzIGZyb20gImpzLWNvb2tpZSI7CgppbXBvcnQgZGF5anMgZnJvbSAiZGF5anMiOwppbXBvcnQgdXRjIGZyb20gJ2RheWpzL3BsdWdpbi91dGMnCgpkYXlqcy5leHRlbmQodXRjKQoKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogJ1NpZ251cEZvcm0nLAogICAgcHJvcHM6IHsKICAgICAgICBlbWFpbDogU3RyaW5nLAogICAgICAgIHBhc3N3b3JkOiBTdHJpbmcsCiAgICAgICAgdXNlcm5hbWU6IFN0cmluZwogICAgfSwKICAgIHN0b3JlLAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBtdXRhYmxlRW1haWw6IHRoaXMuZW1haWwsCiAgICAgICAgICAgIG11dGFibGVQYXNzd29yZDogdGhpcy5wYXNzd29yZCwKICAgICAgICAgICAgbXV0YWJsZVVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lCiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBtYWtlVG9hc3Q6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgICAgICAgdGhpcy4kYnZUb2FzdC50b2FzdChtZXNzYWdlLCB7CiAgICAgICAgICAgICAgICB0aXRsZTogJ0Vycm9yIGR1cmluZyBzaWdudXAnLAogICAgICAgICAgICAgICAgYXV0b0hpZGVEZWxheTogODAwMCwKICAgICAgICAgICAgICAgIHZhcmlhbnQ6ICdkYW5nZXInLAogICAgICAgICAgICAgICAgc29saWQ6IHRydWUKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGxvZ2luOiBhc3luYyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgcmVxUmVnaXN0ZXIgPSBhd2FpdCB1c2Vycy5zaWdudXBVc2VyKHsKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLm11dGFibGVFbWFpbCwKICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLm11dGFibGVQYXNzd29yZCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLm11dGFibGVVc2VybmFtZQogICAgICAgICAgICB9KQogICAgICAgICAgICBpZiAocmVxUmVnaXN0ZXIuVXNlcklkKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXFMb2dpbiA9IGF3YWl0IHVzZXJzLmxvZ2luVXNlcih7CiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMubXV0YWJsZUVtYWlsLAogICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLm11dGFibGVQYXNzd29yZAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGNvbnN0IHZlcmlmaWVkVG9rZW4gPSBhd2FpdCBqd3QudmVyaWZ5KHJlcUxvZ2luLnRva2VuLCAnc2VjcmV0JykKICAgICAgICAgICAgICAgIGNvbnN0IGV4cFRva2VuID0gYXdhaXQgZGF5anMudW5peCh2ZXJpZmllZFRva2VuLmV4cCkuZm9ybWF0KCkKICAgICAgICAgICAgICAgIGF3YWl0IENvb2tpZXMuc2V0KCd0b2tlbicsIHJlcUxvZ2luLnRva2VuLCB7ZXhwaXJlczogbmV3IERhdGUoZXhwVG9rZW4pfSkKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCd1c2Vycy9TVE9SRV9UT0tFTicsIHJlcUxvZ2luLnRva2VuKQogICAgICAgICAgICAgICAgaWYgKHJlcUxvZ2luLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy8nKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXFSZWdpc3Rlci50eXBlID09PSAncGFzc3dvcmQnKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1ha2VUb2FzdCgncGFzc3dvcmQgbXVzdCBjb250YWluIGJldHdlZW4gNiBhbmQgMjAgY2hhcmFjdGVycyBhbmQgYXQgbGVhc3Qgb25lIG51bWVyaWMgZGlnaXQsIG9uZSB1cHBlcmNhc2UgYW5kIG9uZSBsb3dlcmNhc2UgbGV0dGVyJykKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVxUmVnaXN0ZXIudHlwZSA9PT0gJ2VtYWlsJykgewogICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QoJ2ludmFsaWQgZW1haWwgZm9ybWF0JykKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVxUmVnaXN0ZXIuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIHRoaXMubWFrZVRvYXN0KCd1c2VyIGFscmVhZHkgZXhpc3RzJykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["SignupForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SignupForm.vue","sourceRoot":"src/molecules","sourcesContent":["<template>\n  <b-form @submit.prevent=\"login\" class=\"col-8\">\n    <b-form-group\n        id=\"input-group-1\"\n        label=\"Email address:\"\n        label-for=\"input-1\"\n    >\n        <b-form-input\n            id=\"input-1\"\n            v-model=\"mutableEmail\"\n            type=\"text\"\n            placeholder=\"Enter email\"\n            required\n        ></b-form-input>\n    </b-form-group>\n    <b-form-group id=\"input-group-2\" label=\"Your Password:\" label-for=\"input-2\">\n        <b-form-input\n            id=\"input-2\"\n            v-model=\"mutablePassword\"\n            placeholder=\"Enter password\"\n            required\n        ></b-form-input>\n    </b-form-group>\n    <b-form-group id=\"input-group-2\" label=\"Username:\" label-for=\"input-2\">\n        <b-form-input\n            id=\"input-2\"\n            v-model=\"mutableUsername\"\n            placeholder=\"Enter username\"\n            required\n        ></b-form-input>\n    </b-form-group>\n    <b-button type=\"submit\" variant=\"success\">Signup</b-button>\n  </b-form>\n</template>\n\n<script>\nimport users from '../api/users'\n\nimport store from '@/store/index'\nimport jwt from 'jsonwebtoken'\nimport Cookies from \"js-cookie\";\n\nimport dayjs from \"dayjs\";\nimport utc from 'dayjs/plugin/utc'\n\ndayjs.extend(utc)\n\nexport default {\n    name: 'SignupForm',\n    props: {\n        email: String,\n        password: String,\n        username: String\n    },\n    store,\n    data() {\n        return {\n            mutableEmail: this.email,\n            mutablePassword: this.password,\n            mutableUsername: this.username\n        }\n    },\n    methods: {\n        makeToast: function(message) {\n            this.$bvToast.toast(message, {\n                title: 'Error during signup',\n                autoHideDelay: 8000,\n                variant: 'danger',\n                solid: true\n            })\n        },\n        login: async function() {\n            const reqRegister = await users.signupUser({\n                email: this.mutableEmail,\n                password: this.mutablePassword,\n                username: this.mutableUsername\n            })\n            if (reqRegister.UserId) {\n                const reqLogin = await users.loginUser({\n                    email: this.mutableEmail,\n                    password: this.mutablePassword\n                })\n                const verifiedToken = await jwt.verify(reqLogin.token, 'secret')\n                const expToken = await dayjs.unix(verifiedToken.exp).format()\n                await Cookies.set('token', reqLogin.token, {expires: new Date(expToken)})\n                await this.$store.dispatch('users/STORE_TOKEN', reqLogin.token)\n                if (reqLogin.status === 200) {\n                    this.$router.push('/')\n                }\n            }\n            if (reqRegister.type === 'password') {\n                this.makeToast('password must contain between 6 and 20 characters and at least one numeric digit, one uppercase and one lowercase letter')\n            }\n            if (reqRegister.type === 'email') {\n                this.makeToast('invalid email format')\n            }\n            if (reqRegister.status === 409) {\n                this.makeToast('user already exists')\n            }\n        }\n    }\n}\n</script>\n\n<style>\n\n</style>"]}]}